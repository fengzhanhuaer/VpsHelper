{% extends "base.html" %}

{% block title %}ç¼–è¾‘ä»»åŠ¡ - è‡ªåŠ¨å‘é€{% endblock %}

{% block content %}
<h1>âœï¸ ç¼–è¾‘è‡ªåŠ¨å‘é€ä»»åŠ¡</h1>

{% if error %}
<div class="alert alert-error">
    {{ error }}
</div>
{% endif %}

{% if message %}
<div class="alert alert-success">
    {{ message }}
</div>
{% endif %}

<form method="POST" action="{{ url_for('tg_edit_task', task_id=task.id, token=token) if token else url_for('tg_edit_task', task_id=task.id) }}">
    {% if token %}
    <input type="hidden" name="token" value="{{ token }}">
    {% endif %}
    <input type="hidden" name="account_id" value="{{ account_id }}">

    <div class="form-group">
        <label>è´¦å·</label>
        <input type="text" value="{{ account_name }}" disabled 
               style="background: #f0f0f0; cursor: not-allowed;">
    </div>

    <div class="form-group">
        <label>ä¼šè¯</label>
        <input type="text" value="{{ dialog_name }}" disabled 
               style="background: #f0f0f0; cursor: not-allowed;">
    </div>

    <div class="form-group">
        <label for="message">å‘é€å†…å®¹</label>
        <textarea id="message" name="message" rows="6" required>{{ task.message }}</textarea>
    </div>

    <div class="form-group">
        <label for="time_of_day">æ¯å¤©å‘é€æ—¶é—´</label>
        <input type="text" id="time_of_day" name="time_of_day" required 
               value="{{ task.time_of_day }}" placeholder="HH:MM æ ¼å¼ï¼Œä¾‹å¦‚: 09:30">
    </div>

    <div class="form-group">
        <label for="jitter_seconds">éšæœºå»¶è¿Ÿï¼ˆç§’ï¼‰</label>
        <input type="text" id="jitter_seconds" name="jitter_seconds" 
               value="{{ task.jitter_seconds }}" placeholder="0-3600">
    </div>

    <div class="form-group" style="text-align: center;">
        <button type="submit" class="btn">ğŸ’¾ ä¿å­˜ä¿®æ”¹</button>
    </div>
</form>

<div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
    <h3 style="color: #667eea; margin-bottom: 15px;">ğŸ“Š ä»»åŠ¡çŠ¶æ€</h3>
    <table style="width: 100%; margin: 0;">
        <tr>
            <td style="border: none; padding: 8px; font-weight: 600;">çŠ¶æ€:</td>
            <td style="border: none; padding: 8px;">{{ 'âœ… å¯ç”¨' if task.enabled else 'â¸ï¸ æš‚åœ' }}</td>
        </tr>
        <tr>
            <td style="border: none; padding: 8px; font-weight: 600;">ä¸‹æ¬¡è¿è¡Œ:</td>
            <td style="border: none; padding: 8px;">{{ task.next_run_at or '-' }}</td>
        </tr>
        {% if task.last_run_at %}
        <tr>
            <td style="border: none; padding: 8px; font-weight: 600;">æœ€åè¿è¡Œ:</td>
            <td style="border: none; padding: 8px;">{{ task.last_run_at }}</td>
        </tr>
        {% endif %}
        {% if task.last_result %}
        <tr>
            <td style="border: none; padding: 8px; font-weight: 600; vertical-align: top;">æœ€åç»“æœ:</td>
            <td style="border: none; padding: 8px;">{{ task.last_result }}</td>
        </tr>
        {% endif %}
        {% if task.last_reply %}
        <tr>
            <td style="border: none; padding: 8px; font-weight: 600; vertical-align: top;">æ”¶åˆ°å›å¤:</td>
            <td style="border: none; padding: 8px;">{{ task.last_reply }}</td>
        </tr>
        {% endif %}
    </table>
</div>

<div class="back-button">
    <a href="{{ url_for('tg_auto_send_manage', account_id=account_id, token=token) if token else url_for('tg_auto_send_manage', account_id=account_id) }}" class="btn btn-secondary">â¬…ï¸ è¿”å›ä»»åŠ¡åˆ—è¡¨</a>
</div>
{% endblock %}
