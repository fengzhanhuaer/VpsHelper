{% extends "base.html" %}

{% block title %}è´¦å·ç®¡ç† - TGåŠ©æ‰‹{% endblock %}

{% block content %}
<h1>ğŸ‘¥ TGè´¦å·ç®¡ç†</h1>

{% if error %}
<div class="alert alert-error">
    {{ error }}
</div>
{% endif %}

<div style="margin-bottom: 30px; text-align: right;">
    <a href="{{ url_for('tg_add_account_step1', token=token) if token else url_for('tg_add_account_step1') }}" class="btn">â• æ·»åŠ è´¦å·</a>
</div>

{% if accounts %}
<div style="margin-bottom: 30px;">
    <label for="accountSelect" style="display: block; margin-bottom: 10px; font-weight: 600;">é€‰æ‹©è´¦å·ï¼š</label>
    <form method="GET" action="{{ url_for('tg_accounts', token=token) if token else url_for('tg_accounts') }}">
        {% if token %}
        <input type="hidden" name="token" value="{{ token }}">
        {% endif %}
        <select id="accountSelect" name="account_id" onchange="this.form.submit()" 
                style="width: 100%; max-width: 400px;">
            {% for account in accounts %}
            <option value="{{ account.id }}" {{ 'selected' if account.id|string == selected_account_id else '' }}>
                {{ account.account_name }} ({{ account.created_at[:10] if account.created_at else '' }})
            </option>
            {% endfor %}
        </select>
    </form>
</div>

{% if selected_account_id %}
<div style="margin-bottom: 30px;">
    <h3 style="color: #667eea; margin-bottom: 15px;">ä¼šè¯åˆ—è¡¨</h3>
    <form method="POST" action="{{ url_for('tg_refresh_account_dialogs', account_id=selected_account_id, token=token) if token else url_for('tg_refresh_account_dialogs', account_id=selected_account_id) }}" style="margin-bottom: 15px;">
        {% if token %}
        <input type="hidden" name="token" value="{{ token }}">
        {% endif %}
        <button type="submit" class="btn btn-secondary" style="padding: 8px 20px; font-size: 0.9em;">
            ğŸ”„ åˆ·æ–°ä¼šè¯åˆ—è¡¨
        </button>
    </form>
    
    {% if dialogs %}
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>ä¼šè¯åç§°</th>
                    <th>ç”¨æˆ·å</th>
                    <th>ä¼šè¯ID</th>
                </tr>
            </thead>
            <tbody>
                {% for dialog in dialogs %}
                <tr>
                    <td>{{ dialog.title or '-' }}</td>
                    <td>{{ ('@' + dialog.username) if dialog.username else '-' }}</td>
                    <td style="font-family: monospace; font-size: 0.9em;">{{ dialog.dialog_id }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px; color: #999;">
        <p>æš‚æ— ä¼šè¯</p>
        <p style="font-size: 0.9em;">ç‚¹å‡»ä¸Šæ–¹"åˆ·æ–°ä¼šè¯åˆ—è¡¨"æŒ‰é’®åŠ è½½æœ€è¿‘çš„å¯¹è¯</p>
    </div>
    {% endif %}
</div>

<div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
    <h3 style="color: #667eea; margin-bottom: 15px;">è´¦å·æ“ä½œ</h3>
    <form method="POST" action="{{ url_for('delete_account', account_id=selected_account_id, token=token) if token else url_for('delete_account', account_id=selected_account_id) }}"
          onsubmit="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦å·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')" style="display: inline;">
        {% if token %}
        <input type="hidden" name="token" value="{{ token }}">
        {% endif %}
        <button type="submit" class="btn" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);">
            ğŸ—‘ï¸ åˆ é™¤å½“å‰è´¦å·
        </button>
    </form>
</div>
{% endif %}

{% else %}
<div style="text-align: center; padding: 40px; color: #999;">
    <p style="font-size: 1.2em;">æš‚æ— è´¦å·</p>
    <p>ç‚¹å‡»ä¸Šæ–¹"æ·»åŠ è´¦å·"æŒ‰é’®æ¥æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªTGè´¦å·</p>
</div>
{% endif %}

<div class="back-button">
    <a href="{{ url_for('tg_helper', token=token) if token else url_for('tg_helper') }}" class="btn btn-secondary">â¬…ï¸ è¿”å›TGåŠ©æ‰‹</a>
</div>
{% endblock %}
